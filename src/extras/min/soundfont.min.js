/*!
 * timbre.soundfont.js
 * http://skratchdot.com/projects/timbre.soundfont.js/
 *
 * Copyright (c) 2013 skratchdot
 * Licensed under the MIT license.
 */
(function(){"use strict";var e,t,n={},i=5e3,r="https://free-midi.googlecode.com/git/channel/0/instrument/{instrument}/{note}.js?_callback=soundfont_0_{instrument}_{note}",s="gm",o=0,a=0,c=64,u=!0,l={};e=function(e){l.hasOwnProperty(s)||(l[s]={}),l[s].hasOwnProperty(o)||(l[s][o]={}),l[s][o].hasOwnProperty(a)||(l[s][o][a]={}),l[s][o][a].hasOwnProperty(c)||(l[s][o][a][c]={}),l[s][o][a][c].hasOwnProperty(e)||(l[s][o][a][c][e]={sample:null,isLoading:!1,loadTime:(new Date).getTime(),callbacks:[]})},t=function(t,f){var h,d;if(e(t),h=l[s][o][a][c][t],null!==h.sample)f(h,!0);else if(h.isLoading&&i>(new Date).getTime()-h.loadTime)h.callbacks.push(f);else{h.isLoading=!0;try{d=r.replace(/\{name\}/gi,s).replace(/\{channel\}/gi,o).replace(/\{instrument\}/gi,a).replace(/\{length\}/gi,c).replace(/\{note\}/gi,t),timbre("audio"+(u?".jsonp":"")).loadthis(d,function(){var e,i;for(h.sample=this,e=0;h.callbacks.length>e;e++)i=h.callbacks[e],"function"==typeof i&&i(h,!1);h.callbacks=[],h.isLoading=!1,f(h,!1),n.onLoad(h,t)},function(){throw Error('T("audio").loadthis() error.')}).on("ended",function(){h.sample.pause()})}catch(p){h.isLoading=!1,h.sample=null,h.callbacks.push(f),n.onError(p,t)}}},n.emptyCache=function(){l={}},n.setUrlTemplate=function(e){n.emptyCache(),r=e},n.setName=function(e){s=e},n.setChannel=function(e){o=e},n.setInstrument=function(e){a=e},n.setLength=function(e){c=e},n.setJsonp=function(e){u=e===!0?!0:!1},n.preload=function(e){var n,i=function(){};for(n=0;e.length>n;n++)t(e[n],i)},n.play=function(e,n,i){n=n===!1?!1:!0,i="object"==typeof i?i:{},t(e,function(e,t){(t||n)&&e.sample.set(i).play().bang()})},n.onError=function(){},n.onLoad=function(){},timbre&&timbre.modules&&timbre.modules.Decoder&&timbre.modules.Decoder.mp3_decode&&"browser"===timbre.envtype&&(timbre.soundfont=n)})();