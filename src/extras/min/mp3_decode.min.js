/*!
 * timbre.mp3_decode.js
 * http://skratchdot.com/projects/timbre.mp3_decode.js/
 *
 * Copyright (c) 2013 skratchdot
 * Licensed under the MIT license.
 */
"undefined"!=typeof timbre&&"undefined"!=typeof Mad&&"browser"===timbre.envtype&&!function(a){a.modules.Decoder.mp3_decode=function(){var b=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=0,u=[],v=0;try{for(g=new Mad.ArrayBuffers.ArrayStream(a),h=new Mad.MP3File(g),i=h.getMpegStream(),j=new Mad.Synth,k=new Mad.Frame,k=Mad.Frame.decode(k,i);null!==k;){if(j.frame(k),s||(l=j.pcm.channels,m=j.pcm.samplerate,s=!0),t+=j.pcm.length,u.push({mixdown:void 0,bufferL:void 0,bufferR:void 0}),u[v].mixdown=new Float32Array(j.pcm.length),2===l)for(u[v].bufferL=new Float32Array(j.pcm.length),u[v].bufferR=new Float32Array(j.pcm.length),d=0;d<j.pcm.length;d++)f=u[v].bufferL[d]=j.pcm.samples[0][d],f+=u[v].bufferR[d]=j.pcm.samples[1][d],u[v].mixdown[d]=.5*f;else if(1===l)for(d=0;d<j.pcm.length;d++)u[v].mixdown[d]=j.pcm.samples[0][d];k=Mad.Frame.decode(k,i),v++}}catch(w){}if(0===t||1>l||l>2)return b(!1);for(p=new Float32Array(t),2===l&&(q=new Float32Array(t),r=new Float32Array(t)),b({samplerate:m,channels:l,buffer:[p,q,r],duration:t/m}),o=0,d=0;d<u.length;d++)for(n=u[d],e=0;e<n.mixdown.length;e++)p[o]=n.mixdown[e],2===l&&(q[o]=n.bufferL[e],r[o]=n.bufferR[e]),o++;c()};return function(c,d,e){"string"==typeof c?a.modules.Decoder.getBinaryWithPath(c,function(a){b(a,d,e)}):b(c,d,e)}}()}(timbre);